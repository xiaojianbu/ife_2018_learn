<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Day-25</title>
</head>

<body>
  <p id="date"></p>
  <p id="date-1"></p>

  <!-- 任务四 -->
  <select id="year-select">
    <option value="2000">2000</option>
    <option value="2001">2001</option>
    <option value="2002">2002</option>
    <option value="2003">2003</option>
    <option value="2004">2004</option>
    <option value="2005">2005</option>
    <option value="2006">2006</option>
    <option value="2007">2007</option>
    <option value="2008">2008</option>
    <option value="2009">2009</option>
    <option value="2010">2010</option>
    <option value="2011">2011</option>
    <option value="2012">2012</option>
    <option value="2013">2013</option>
    <option value="2014">2014</option>
    <option value="2015">2015</option>
    <option value="2016">2016</option>
    <option value="2017">2017</option>
    <option value="2018">2018</option>
    <option value="2019">2019</option>
    <option value="2020">2020</option>
    <option value="2021">2021</option>
    <option value="2022">2022</option>
    <option value="2023">2023</option>
    <option value="2024">2024</option>
    <option value="2025">2025</option>
    <option value="2026">2026</option>
    <option value="2027">2027</option>
    <option value="2028">2028</option>
    <option value="2029">2029</option>
    <option value="2030">2030</option>
    <option value="2031">2031</option>
    <option value="2032">2032</option>
  </select>

  <select id="month-select">
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
    <option value="7">7</option>
    <option value="8">8</option>
    <option value="9">9</option>
    <option value="10">10</option>
    <option value="11">11</option>
    <option value="12">12</option>
  </select>

  <select id="day-select">
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
    <option value="7">7</option>
    <option value="8">8</option>
    <option value="9">9</option>
    <option value="10">10</option>
    <option value="11">11</option>
    <option value="12">12</option>
    <option value="13">13</option>
    <option value="14">14</option>
    <option value="15">15</option>
    <option value="16">16</option>
    <option value="17">17</option>
    <option value="18">18</option>
    <option value="19">19</option>
    <option value="20">20</option>
    <option value="21">21</option>
    <option value="22">22</option>
    <option value="23">23</option>
    <option value="24">24</option>
    <option value="25">25</option>
    <option value="26">26</option>
    <option value="27">27</option>
    <option value="28">28</option>
    <option value="29">29</option>
    <option value="30">30</option>
    <option value="31">31</option>
  </select>

  <select id="hour-select">
    <option value="0">00</option>
    <option value="1">01</option>
    <option value="2">02</option>
    <option value="3">03</option>
    <option value="4">04</option>
    <option value="5">05</option>
    <option value="6">06</option>
    <option value="7">07</option>
    <option value="8">08</option>
    <option value="9">09</option>
    <option value="10">10</option>
    <option value="11">11</option>
    <option value="12">12</option>
    <option value="13">13</option>
    <option value="14">14</option>
    <option value="15">15</option>
    <option value="16">16</option>
    <option value="17">17</option>
    <option value="18">18</option>
    <option value="19">19</option>
    <option value="20">20</option>
    <option value="21">21</option>
    <option value="22">22</option>
    <option value="23">23</option>
  </select>

  <select id="minute-select">
    <option value="0">0</option>
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
    <option value="7">7</option>
    <option value="8">8</option>
    <option value="9">9</option>
    <option value="10">10</option>
    <option value="11">11</option>
    <option value="12">12</option>
    <option value="13">13</option>
    <option value="14">14</option>
    <option value="15">15</option>
    <option value="16">16</option>
    <option value="17">17</option>
    <option value="18">18</option>
    <option value="19">19</option>
    <option value="20">20</option>
    <option value="21">21</option>
    <option value="22">22</option>
    <option value="23">23</option>
    <option value="24">24</option>
    <option value="25">25</option>
    <option value="26">26</option>
    <option value="27">27</option>
    <option value="28">28</option>
    <option value="29">29</option>
    <option value="30">30</option>
    <option value="31">31</option>
    <option value="32">32</option>
    <option value="33">33</option>
    <option value="34">34</option>
    <option value="35">35</option>
    <option value="36">36</option>
    <option value="37">37</option>
    <option value="38">38</option>
    <option value="39">39</option>
    <option value="40">40</option>
    <option value="41">41</option>
    <option value="42">42</option>
    <option value="43">43</option>
    <option value="44">44</option>
    <option value="45">45</option>
    <option value="46">46</option>
    <option value="47">47</option>
    <option value="48">48</option>
    <option value="49">49</option>
    <option value="50">40</option>
    <option value="51">41</option>
    <option value="52">42</option>
    <option value="53">43</option>
    <option value="54">44</option>
    <option value="55">45</option>
    <option value="56">46</option>
    <option value="57">47</option>
    <option value="58">48</option>
    <option value="59">59</option>
  </select>

  <select id="second-select">
    <option value="0">0</option>
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
    <option value="7">7</option>
    <option value="8">8</option>
    <option value="9">9</option>
    <option value="10">10</option>
    <option value="11">11</option>
    <option value="12">12</option>
    <option value="13">13</option>
    <option value="14">14</option>
    <option value="15">15</option>
    <option value="16">16</option>
    <option value="17">17</option>
    <option value="18">18</option>
    <option value="19">19</option>
    <option value="20">20</option>
    <option value="21">21</option>
    <option value="22">22</option>
    <option value="23">23</option>
    <option value="24">24</option>
    <option value="25">25</option>
    <option value="26">26</option>
    <option value="27">27</option>
    <option value="28">28</option>
    <option value="29">29</option>
    <option value="30">30</option>
    <option value="31">31</option>
    <option value="32">32</option>
    <option value="33">33</option>
    <option value="34">34</option>
    <option value="35">35</option>
    <option value="36">36</option>
    <option value="37">37</option>
    <option value="38">38</option>
    <option value="39">39</option>
    <option value="40">40</option>
    <option value="41">41</option>
    <option value="42">42</option>
    <option value="43">43</option>
    <option value="44">44</option>
    <option value="45">45</option>
    <option value="46">46</option>
    <option value="47">47</option>
    <option value="48">48</option>
    <option value="49">49</option>
    <option value="50">40</option>
    <option value="51">41</option>
    <option value="52">42</option>
    <option value="53">43</option>
    <option value="54">44</option>
    <option value="55">45</option>
    <option value="56">46</option>
    <option value="57">47</option>
    <option value="58">48</option>
    <option value="59">59</option>
  </select>

  <p id="result-wrapper"></p>
  <script>
    // 任务1
    function Go() {
      console.log('Go')
    }

    function GoSteps(n = 1) {
      let step
      step = isNaN(n) ? 0 : Math.floor(Number(n))
      step = step < 0 ? 0 : step
      while (step) {
        Go()
        step -= 1
      }
    }
    GoSteps(10); // Go 10次
    GoSteps(1); // Go 1次
    GoSteps(); // Go 1次，认为缺少参数时，默认参数为1
    GoSteps(0); // 0次
    GoSteps(-1); // 0次
    GoSteps(1.4); // Go 1次
    GoSteps(1.6); // Go 1次
    GoSteps(-1); // 0次
    GoSteps(true); // Go 1次
    GoSteps(false); // 0次
    GoSteps("Test"); // 0次
    GoSteps(NaN); // 0次
    GoSteps(null); // 0次

    // 任务二和任务三
    let date = document.querySelector('#date')
    let date1 = document.querySelector('#date-1')

    function getWeekday(time, lang) {
      if (lang === 'cn') {
        let weekDay = ['星期天', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六']

        return weekDay[time.getDay()]
      } else {
        let weekDay = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday']

        return weekDay[time.getDay()]
      }
    }

    function pad(num) {
      return String(num).padStart(2, '0')
    }

    function formatTime(time, lang = 'cn') {
      return {
        year: time.getFullYear(),
        month: pad(time.getMonth() + 1),
        day: pad(time.getDate()),
        weekDay: getWeekday(time, lang),
        hours: pad(time.getHours()),
        minutes: pad(time.getMinutes()),
        seconds: pad(time.getSeconds())
      }
    }

    function showDate() {
      setInterval(() => {
        let time = new Date()
        let formatCnTime = formatTime(time)
        let formatEnTime = formatTime(time, 'en')
        date.innerHTML =
          `${formatCnTime.year}年${formatCnTime.month}月${formatCnTime.day}日${formatCnTime.weekDay} ${formatCnTime.hours}:${formatCnTime.minutes}:${formatCnTime.seconds}`
        date1.innerHTML =
          `${formatEnTime.year}-${formatEnTime.month}-${formatEnTime.day} ${formatEnTime.weekDay} ${formatEnTime.hours}:${formatEnTime.minutes}:${formatEnTime.seconds} ${formatEnTime.hours < 12 ? 'AM' : 'PM'}`
      }, 1000)
    }
    showDate()

    // 任务四
    let show
    let yearSelect = document.querySelector('#year-select')
    let monthSelect = document.querySelector('#month-select')
    let daySelect = document.querySelector('#day-select')
    let hourSelect = document.querySelector('#hour-select')
    let minuteSelect = document.querySelector('#minute-select')
    let secondSelect = document.querySelector('#second-select')
    let daySelectOptions = daySelect.querySelectorAll('option')
    let resultWrapper = document.querySelector('#result-wrapper')

    function isLeapYear(year) {
      if (year % 400 === 0 || (year % 4 === 0 && year % 100 !== 0)) {
        return true
      } else {
        return false
      }
    }

    function changeDaySelectOption() {
      let monthSelectValue = monthSelect.value

      if (monthSelectValue === '4' || monthSelectValue === '6' || monthSelectValue === '9' || monthSelectValue ===
        '11') {
        daySelectOptions[28].disabled = false
        daySelectOptions[29].disabled = false
        daySelectOptions[30].disabled = true
        if (daySelect.value > 30) {
          daySelect.value = 30
        }
      } else if (monthSelectValue === '2') {
        if (isLeapYear(yearSelect.value)) {
          daySelectOptions[28].disabled = false
          if (daySelect.value > 29) {
            daySelect.value = 29
          }
        } else {
          daySelectOptions[28].disabled = true
          if (daySelect.value > 28) {
            daySelect.value = 28
          }
        }
        daySelectOptions[29].disabled = true
        daySelectOptions[30].disabled = true
      } else {
        daySelectOptions[28].disabled = false
        daySelectOptions[29].disabled = false
        daySelectOptions[30].disabled = false
      }
    }


    function changeTime(ms) {
      const day = parseInt(ms / (1000 * 60 * 60 * 24), 10)
      const hour = parseInt((ms % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60), 10)
      const min = parseInt((ms % (1000 * 60 * 60)) / (1000 * 60), 10)
      const second = parseInt((ms % (1000 * 60)) / 1000, 10)
      return `${day}天${hour}小时${min}分${second}秒`
    }

    function calculateTime() {
      let targetTime = new Date(yearSelect.value, monthSelect.value - 1, daySelect.value, hourSelect.value,
        minuteSelect.value,
        secondSelect.value)
      let nowTime = Date.now()
      let formatTargetTime = formatTime(targetTime)

      if (nowTime < targetTime) {
        return `现在距离 ${formatTargetTime.year}年${formatTargetTime.month}月${formatTargetTime.day}日${formatTargetTime.weekDay} ${formatTargetTime.hours}:${formatTargetTime.minutes}:${formatTargetTime.seconds} 还有 ${changeTime(targetTime - nowTime)}`
      } else {
        return `现在距离 ${formatTargetTime.year}年${formatTargetTime.month}月${formatTargetTime.day}日${formatTargetTime.weekDay} ${formatTargetTime.hours}:${formatTargetTime.minutes}:${formatTargetTime.seconds} 已经过去 ${changeTime(nowTime - targetTime)}`
      }
    }

    function showTime() {
      resultWrapper.innerHTML = calculateTime()
      show = setInterval(() => {
        resultWrapper.innerHTML = calculateTime()
      }, 1000)
    }

    yearSelect.addEventListener('change', function () {
      clearInterval(show)
      changeDaySelectOption()
      showTime()
    })

    monthSelect.addEventListener('change', function () {
      clearInterval(show)
      changeDaySelectOption()
      showTime()
    })

    daySelect.addEventListener('change', function () {
      clearInterval(show)
      showTime()
    })

    hourSelect.addEventListener('change', function () {
      clearInterval(show)
      showTime()
    })

    minuteSelect.addEventListener('change', function () {
      clearInterval(show)
      showTime()
    })

    secondSelect.addEventListener('change', function () {
      clearInterval(show)
      showTime()
    })
    showTime()

  </script>
</body>

</html>
